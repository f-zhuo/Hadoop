**定义：**一个松散耦合的分布式系统的粗粒度锁以及可靠性存储（低容量）的系统

* 松散耦合：对硬件要求不严格，在大部分节点都能使用

* 分布式：多节点

* 粗粒度锁：粒度是节点级的，各节点在物理隔离的状态下，通过这把锁来维持生态

* 可靠性存储：类似数据库，共享资源，但存储容量小

Zookeeper是一个分布式锁，对集群的稳定性起到关键作用，在任何一个节点都可以访问。类似于文件管理系统，每个“目录文件”都叫做节点，可以存储一些数据，必须指定**绝对路径**来访问节点

节点分为：

* persistent nodes

永久节点，除非手动删除，否则一直存在。创建时的默认节点

* ephemeral nodes

临时节点，由client创建，在client连接时有效，client失效，该节点会被zookeeper删除

* sequence nodes

序列节点，client创建节点时，zookeeper会按顺序给节点末尾追加序列号。该类型节点不允许单独存在，必须和以上两种联合使用

所以节点的使用有四种情况：永久，临时，永久&序列，临时&序列

 **监控机制**

* 监控数据（getData）

* 监控节点是否存在（exists）

* 监控父节点下子节点列表是否发生变化（getChildren）

  子节点失效，父节点可以监控到并告知client。这种监控是一次性的，触发后需要在client再次设置监控。父节点下的多子节点失效只会触发一次监控

**访问控制链/ACL**

每个节点的ACL（access control list）保存了client对节点的访问权限，用三元数组来描述(scheme:expression,perms) 即（模式：用户，权限），如 (ip:192.2.0.0/16, READ)

|  模式  |                             描述                             |
| :----: | :----------------------------------------------------------: |
| world  | 只有一个用户anyone, world:anyone代表任何人，是所有人有权限的结点 |
|  auth  |                        已经认证的用户                        |
| digest |        通过username：password字符串的MD5编码认证用户         |
|  host  | 匹配主机名后缀，如host:com匹配host:host1.com，但不能匹配host:host1.cn |
|   ip   |            通过IP识别用户，表达式格式为 addr/bits            |

| 权限   | 描述                     |
| ------ | ------------------------ |
| create | 创建子节点               |
| read   | 读取节点数据和子节点列表 |
| write  | 修改节点数据             |
| delete | 删除子节点               |
| admin  | 设置节点权限             |

**zookeeper选举**

在集群中，选择当前是最小编号的一个节点作为主节点，主节点挂掉，再选取一个

**共享锁**

在某个节点访问时阻止其他节点修改，保证数据全局一致

**队列管理**

* 同步队列：所有节点运行，数据完整后才工作

* FIFO：先入先出队列，先运行的节点先工作



**zookeeper的启动：**

在bin目录下

```shell
./zkServer.sh start
```

zookeeper的启动需要在每个节点执行，不像Hadoop只在主节点启动

**检验zookeeper是否启动：**

在bin目录下

```shell
./zkServer.sh status
```

结果是leader/follower